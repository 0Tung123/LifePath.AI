(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[847],{2302:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let a=n(3464).A.create({baseURL:"http://localhost:3000",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")),Promise.reject(e)));let s=a},3158:(e,t,n)=>{Promise.resolve().then(n.bind(n,9564))},5695:(e,t,n)=>{"use strict";var a=n(8999);n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},9564:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var a=n(5155),s=n(2115),i=n(5695),l=n(6874),c=n.n(l),r=n(2302);let o=e=>{let{onCharacterCreated:t}=e,n=(0,i.useRouter)(),[l,c]=(0,s.useState)(""),[o,d]=(0,s.useState)(""),[u,h]=(0,s.useState)("male"),[m,g]=(0,s.useState)(""),[x,b]=(0,s.useState)(""),[p,v]=(0,s.useState)([]),[f,j]=(0,s.useState)(""),[N,y]=(0,s.useState)(!1),[k,w]=(0,s.useState)(""),[C,S]=(0,s.useState)(!1),[A,G]=(0,s.useState)({title:"",background:"",introduction:""});(0,s.useEffect)(()=>{(async()=>{try{let e=await r.A.get("/game/genres");v(e.data),e.data.length>0&&j(e.data[0].id)}catch(e){console.error("Lỗi khi lấy danh s\xe1ch thể loại:",e),w("Kh\xf4ng thể tải danh s\xe1ch thể loại game. Vui l\xf2ng thử lại sau.")}})()},[]);let T=async e=>{if(!o||!f)return void w("Vui l\xf2ng nhập t\xean nh\xe2n vật v\xe0 chọn thể loại trước khi tạo gợi \xfd từ AI");y(!0);try{let t=p.find(e=>e.id===f),n=t?t.name:f,a="";"title"===e?a="Gợi \xfd một ti\xeau đề ngắn gọn cho c\xe2u chuyện về nh\xe2n vật ".concat(o,", một ").concat("male"===u?"nam":"nữ"," trong thế giới ").concat(n,"."):"background"===e?a="Gợi \xfd một bối cảnh ngắn gọn (2-3 c\xe2u) cho nh\xe2n vật ".concat(o,", một ").concat("male"===u?"nam":"nữ"," trong thế giới ").concat(n,"."):"introduction"===e&&(a="Viết một đoạn giới thiệu ngắn (3-4 c\xe2u) về nh\xe2n vật ".concat(o,", một ").concat("male"===u?"nam":"nữ"," trong thế giới ").concat(n,". ").concat(m?"Bối cảnh: "+m:""));let s=await r.A.post("/ai/generate",{prompt:a});G(t=>({...t,[e]:s.data.content})),"title"===e?c(s.data.content):"background"===e?g(s.data.content):"introduction"===e&&b(s.data.content)}catch(e){console.error("Lỗi khi tạo gợi \xfd từ AI:",e),w("Kh\xf4ng thể tạo gợi \xfd từ AI. Vui l\xf2ng thử lại sau.")}finally{y(!1)}},V=async()=>{if(!o)return void w("Vui l\xf2ng nhập t\xean nh\xe2n vật");S(!0);try{let e="\n        T\xean: ".concat(o,"\n        Giới t\xednh: ").concat("male"===u?"Nam":"Nữ","\n        ").concat(m?"Bối cảnh: "+m:"","\n        ").concat(x?"Giới thiệu: "+x:"","\n      "),a=await r.A.post("/game/characters/generate",{description:e,primaryGenre:f});a.data&&a.data.id&&(await r.A.post("/game/characters/".concat(a.data.id,"/metadata"),{title:l,gender:u,background:m,introduction:x}),t?t(a.data.id):n.push("/game/characters"))}catch(e){console.error("Lỗi khi tạo nh\xe2n vật:",e),w("Kh\xf4ng thể tạo nh\xe2n vật. Vui l\xf2ng thử lại sau.")}finally{S(!1)}};return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-gray-800 rounded-lg shadow-lg text-white",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Tạo Nh\xe2n Vật Mới"}),k&&(0,a.jsx)("div",{className:"bg-red-500 text-white p-3 rounded-md mb-4",children:k}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Ti\xeau đề c\xe2u chuyện"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Nhập ti\xeau đề c\xe2u chuyện của bạn",className:"w-full p-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{onClick:()=>T("title"),disabled:N,className:"px-4 py-2 bg-blue-600 rounded-md hover:bg-blue-700 transition duration-300 disabled:opacity-50",children:N?"Đang tạo...":"Gợi \xfd"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["T\xean nh\xe2n vật ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"Nhập t\xean nh\xe2n vật của bạn",className:"w-full p-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Giới t\xednh"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"gender",checked:"male"===u,onChange:()=>h("male"),className:"mr-2"}),"Nam"]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"gender",checked:"female"===u,onChange:()=>h("female"),className:"mr-2"}),"Nữ"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Thể loại ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("select",{value:f,onChange:e=>j(e.target.value),className:"w-full p-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:p.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ",e.description]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Bối cảnh"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("textarea",{value:m,onChange:e=>g(e.target.value),placeholder:"M\xf4 tả bối cảnh của nh\xe2n vật (t\xf9y chọn)",className:"w-full p-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px]"}),(0,a.jsx)("button",{onClick:()=>T("background"),disabled:N,className:"px-4 py-2 bg-blue-600 rounded-md hover:bg-blue-700 transition duration-300 disabled:opacity-50 h-fit",children:N?"Đang tạo...":"Gợi \xfd"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Giới thiệu bản th\xe2n"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("textarea",{value:x,onChange:e=>b(e.target.value),placeholder:"Viết giới thiệu ngắn về nh\xe2n vật của bạn (t\xf9y chọn)",className:"w-full p-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px]"}),(0,a.jsx)("button",{onClick:()=>T("introduction"),disabled:N,className:"px-4 py-2 bg-blue-600 rounded-md hover:bg-blue-700 transition duration-300 disabled:opacity-50 h-fit",children:N?"Đang tạo...":"Gợi \xfd"})]})]}),(0,a.jsx)("div",{className:"flex justify-center mt-8",children:(0,a.jsx)("button",{onClick:V,disabled:C||!o||!f,className:"px-6 py-3 bg-green-600 rounded-md hover:bg-green-700 transition duration-300 disabled:opacity-50 font-bold text-lg",children:C?"Đang tạo nh\xe2n vật...":"Tạo nh\xe2n vật"})})]})]})},d=()=>{let e=(0,i.useRouter)();return(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-6",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Tạo nh\xe2n vật mới"}),(0,a.jsx)(c(),{href:"/game/characters",className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md transition duration-300",children:"Quay lại"})]}),(0,a.jsx)(o,{onCharacterCreated:t=>{e.push("/game/characters")}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[464,874,441,684,358],()=>t(3158)),_N_E=e.O()}]);