(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{2585:(e,s,a)=>{Promise.resolve().then(a.bind(a,7535))},4195:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var r=a(5155);a(2115);let t=e=>{let{title:s,children:a,className:t="",footer:l}=e;return(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden ".concat(t),children:[s&&(0,r.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 px-4 py-3",children:(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:s})}),(0,r.jsx)("div",{className:"px-4 py-4",children:a}),l&&(0,r.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 px-4 py-3",children:l})]})}},5695:(e,s,a)=>{"use strict";var r=a(8999);a.o(r,"useRouter")&&a.d(s,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(s,{useSearchParams:function(){return r.useSearchParams}})},6374:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var r=a(5155);a(2115);let t=e=>{let{size:s="medium",message:a="Đang tải..."}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-2",children:[(0,r.jsx)("div",{className:"".concat({small:"w-5 h-5",medium:"w-8 h-8",large:"w-12 h-12"}[s]," animate-spin rounded-full border-b-2 border-primary")}),a&&(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:a})]})}},7535:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>y});var r=a(5155),t=a(2115),l=a(5695),i=a(6874),n=a.n(i),d=a(1762),c=a(6374),h=a(8377);let m=e=>{let{character:s,session:a,onSaveGame:t,onEndGame:l,isSaving:i=!1}=e;return s?(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[(0,r.jsxs)("div",{className:"mb-4 md:mb-0",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s.name}),(0,r.jsx)("div",{className:"flex items-center mt-1",children:(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Cấp độ ",s.level," • Kinh nghiệm: ",s.experience]})})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(h.A,{variant:"secondary",size:"sm",onClick:t,isLoading:i,leftIcon:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),children:"Lưu game"}),(0,r.jsx)(h.A,{variant:"danger",size:"sm",onClick:l,leftIcon:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),children:"Kết th\xfac"})]})]})}):null},x=e=>{let{node:s,onMakeChoice:a,isLoading:t=!1}=e;return(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 md:p-6 mb-4",children:[(0,r.jsxs)("div",{className:"prose dark:prose-invert max-w-none mb-6",children:[s.image&&(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("img",{src:s.image,alt:"Story illustration",className:"w-full h-auto rounded-lg object-cover max-h-80"})}),(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:s.content},className:"whitespace-pre-wrap"})]}),s.choices&&s.choices.length>0&&(0,r.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Lựa chọn của bạn:"}),s.choices.map(e=>(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(h.A,{variant:"secondary",isFullWidth:!0,size:"lg",onClick:()=>a(e.id),isLoading:t,disabled:t,className:"text-left justify-start border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 bg-transparent text-gray-800 dark:text-gray-200",children:e.text})},e.id))]})]})},o=[{id:"dialog",label:"Đối thoại",placeholder:"Nhập điều bạn muốn n\xf3i..."},{id:"action",label:"H\xe0nh động",placeholder:"M\xf4 tả h\xe0nh động bạn muốn thực hiện..."},{id:"examine",label:"Quan s\xe1t",placeholder:"Nhập thứ bạn muốn quan s\xe1t kỹ hơn..."}],g=e=>{let{onSubmit:s,inputTypes:a=o,isLoading:l=!1}=e,[i,n]=(0,t.useState)(a[0].id),[d,c]=(0,t.useState)(""),[m,x]=(0,t.useState)(""),g=a.find(e=>e.id===i)||a[0];return(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d.trim()&&s(i,d,m||void 0).then(()=>{c(""),x("")}).catch(e=>{console.error("Error submitting user input:",e)})},children:[(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:a.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>n(e.id),className:"px-3 py-1 rounded-full text-sm font-medium transition-colors ".concat(i===e.id?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:e.label},e.id))})}),"examine"===i&&(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"Đối tượng cần quan s\xe1t",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md  focus:outline-none focus:ring-2 focus:ring-blue-500  bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100",disabled:l})}),(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsx)("textarea",{value:d,onChange:e=>c(e.target.value),placeholder:g.placeholder,rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md  focus:outline-none focus:ring-2 focus:ring-blue-500  bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100",disabled:l})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(h.A,{type:"submit",variant:"primary",isLoading:l,disabled:l||!d.trim(),children:"Gửi"})})]})})};var u=a(4195);let p=e=>{let{quests:s}=e;if(!s||0===s.length)return null;let a=s.filter(e=>!e.isCompleted),t=s.filter(e=>e.isCompleted);return(0,r.jsx)(u.A,{title:"Nhiệm vụ",children:(0,r.jsxs)("div",{className:"space-y-6",children:[a.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-md font-medium text-gray-900 dark:text-white mb-3",children:"Đang theo d\xf5i"}),(0,r.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,r.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-yellow-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm0-9a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm0-4a1 1 0 100 2 1 1 0 000-2z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h5",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.title}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:e.description}),e.reward&&(0,r.jsxs)("div",{className:"mt-1 text-xs text-green-600 dark:text-green-400",children:["Phần thưởng: ",e.reward]})]})]})},e.id))})]}),t.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-md font-medium text-gray-900 dark:text-white mb-3",children:"Đ\xe3 ho\xe0n th\xe0nh"}),(0,r.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,r.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md opacity-75",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-green-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h5",{className:"text-sm font-medium text-gray-900 dark:text-white line-through",children:e.title}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:e.description}),e.reward&&(0,r.jsxs)("div",{className:"mt-1 text-xs text-green-600 dark:text-green-400",children:["Đ\xe3 nhận: ",e.reward]})]})]})},e.id))})]})]})})},j=e=>{var s,a,i,n;let{gameSessionId:h}=e,o=(0,l.useRouter)(),{currentSession:u,currentNode:j,loadingSession:b,error:y,fetchGameSession:v,makeChoice:N,processUserInput:f,saveGame:w,endGame:k}=(0,d.I)(),[C,L]=(0,t.useState)(!1),[S,z]=(0,t.useState)(null);(0,t.useEffect)(()=>{v(h)},[h,v]);let A=async e=>{await N(e)},M=async(e,s,a)=>{await f({type:e,content:s,target:a})},R=async()=>{try{L(!0),await w(h),alert("Game đ\xe3 được lưu th\xe0nh c\xf4ng!")}catch(e){console.error("Failed to save game:",e)}finally{L(!1)}},B=async()=>{if(window.confirm("Bạn c\xf3 chắc chắn muốn kết th\xfac phi\xean chơi n\xe0y? Bạn sẽ kh\xf4ng thể tiếp tục phi\xean n\xe0y nữa."))try{await k(h),o.push("/game")}catch(e){console.error("Failed to end game:",e)}};return b&&!u?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-900 text-white",children:(0,r.jsx)(c.A,{size:"large",message:"Đang tải phi\xean game..."})}):y?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-900 text-white",children:(0,r.jsxs)("div",{className:"text-xl text-red-500 max-w-md text-center p-6",children:[(0,r.jsx)("div",{className:"mb-4",children:"Đ\xe3 xảy ra lỗi:"}),(0,r.jsx)("div",{children:y})]})}):u&&j?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white p-4",children:[(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsx)(m,{character:u.character,session:u,onSaveGame:R,onEndGame:B,isSaving:C}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mt-4",children:[(0,r.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,r.jsx)(x,{node:j,onMakeChoice:A,isLoading:b}),(0,r.jsx)(g,{onSubmit:M,isLoading:b})]}),(0,r.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-md p-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Nh\xe2n vật"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"T\xean:"})," ",null==(s=u.character)?void 0:s.name]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Cấp độ:"})," ",null==(a=u.character)?void 0:a.level]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Kinh nghiệm:"})," ",null==(i=u.character)?void 0:i.experience," XP"]}),(null==(n=u.character)?void 0:n.traits)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Đặc điểm:"}),(0,r.jsx)("div",{className:"flex flex-wrap mt-1",children:u.character.traits.map((e,s)=>(0,r.jsx)("span",{className:"bg-gray-700 text-xs px-2 py-1 rounded mr-2 mb-1",children:e},s))})]})]})]}),u.quests&&(0,r.jsx)(p,{quests:u.quests})]})]})]}),S&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg max-w-md w-full",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:S.name}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Tuổi:"})," ",S.info.age]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Cấp độ:"})," ",S.info.level]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Mối quan hệ:"})," ",S.info.relationship]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Mức độ th\xe2n thiết:"})," ",S.info.relationshipValue,"/100"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"M\xf4 tả:"})," ",S.info.description]})]}),(0,r.jsx)("button",{className:"mt-4 bg-blue-600 px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300",onClick:()=>z(null),children:"Đ\xf3ng"})]})})]}):(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-900 text-white",children:(0,r.jsx)("div",{className:"text-xl max-w-md text-center p-6",children:"Phi\xean chơi game kh\xf4ng tồn tại hoặc đ\xe3 kết th\xfac"})})};var b=a(7182);let y=e=>{let{params:s}=e;(0,l.useRouter)();let{id:a}=s,{isAuthenticated:t,isLoading:i}=(0,b.A)(),{error:h}=(0,d.I)();return i?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-900 text-white",children:(0,r.jsx)(c.A,{size:"large",message:"Đang tải..."})}):t?h?(0,r.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-6",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto bg-gray-800 p-8 rounded-lg shadow-lg",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-red-500 mb-4",children:"Lỗi"}),(0,r.jsx)("p",{className:"mb-6",children:h}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(n(),{href:"/game",className:"bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-md transition duration-300",children:"Quay lại trang ch\xednh"})})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-900 text-white",children:(0,r.jsx)(j,{gameSessionId:a})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-6",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto bg-gray-800 p-8 rounded-lg shadow-lg",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Đăng nhập để tiếp tục"}),(0,r.jsx)("p",{className:"mb-6",children:"Bạn cần đăng nhập để truy cập phi\xean chơi game n\xe0y."}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(n(),{href:"/auth/login",className:"bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-md transition duration-300",children:"Đăng nhập"})})]})})}},8377:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var r=a(5155);a(2115);let t=e=>{let{children:s,variant:a="primary",size:t="md",isLoading:l=!1,isFullWidth:i=!1,leftIcon:n,rightIcon:d,className:c="",disabled:h,...m}=e;return(0,r.jsx)("button",{disabled:h||l,className:"\n        ".concat({primary:"bg-blue-600 hover:bg-blue-700 text-white",secondary:"bg-gray-500 hover:bg-gray-600 text-white",success:"bg-green-600 hover:bg-green-700 text-white",danger:"bg-red-600 hover:bg-red-700 text-white",warning:"bg-yellow-500 hover:bg-yellow-600 text-white",info:"bg-cyan-500 hover:bg-cyan-600 text-white"}[a]," \n        ").concat({sm:"py-1 px-2 text-sm",md:"py-2 px-4 text-base",lg:"py-2.5 px-5 text-lg"}[t]," \n        ").concat(i?"w-full":""," \n        rounded-md font-medium transition duration-150 ease-in-out \n        focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:ring-blue-500\n        disabled:opacity-60 disabled:cursor-not-allowed\n        ").concat(c,"\n      "),...m,children:l?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("span",{children:"Đang xử l\xfd..."})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[n&&(0,r.jsx)("span",{className:"mr-2",children:n}),s,d&&(0,r.jsx)("span",{className:"ml-2",children:d})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[464,874,364,441,684,358],()=>s(2585)),_N_E=e.O()}]);